{%- liquid
  assign bg_image = section.settings.bg_image
  assign bg_height_desktop = section.settings.bg_height_desktop
  assign bg_height_mobile = section.settings.bg_height_mobile

  assign footer_vh_desktop = section.settings.footer_vh_desktop
  assign footer_vh_mobile = section.settings.footer_vh_mobile

  assign intro_heading = section.settings.intro_heading
  assign intro_body = section.settings.intro_body

  assign logo_full = section.settings.logo_full

  assign menu_1 = section.settings.menu_1
  assign menu_2 = section.settings.menu_2
  assign menu_1_title = section.settings.menu_1_title
  assign menu_2_title = section.settings.menu_2_title

  assign klaviyo_embed = section.settings.klaviyo_embed

  assign newsletter_block = section.blocks | where: 'type', 'newsletter'
  assign newsletter_block = newsletter_block[0]

  assign credits_label = section.settings.credits_label
  assign credits_url = section.settings.credits_url
-%}

{%- style -%}
  #FooterCustom-{{ section.id }} {
    position: relative;
    overflow: hidden;
    min-height: {{ footer_vh_desktop }}vh;
  }

  /* Background image pinned to bottom, full-width */
  #FooterCustom-{{ section.id }} .footer-custom__bg {
    position: absolute;
    inset: auto 0 0 0;
    height: {{ bg_height_desktop }}px;
    z-index: 0;
    pointer-events: none;
  }

  #FooterCustom-{{ section.id }} .footer-custom__bg img {
    width: 100%;
    height: 100%;
    display: block;

    /* Desktop: prevent awkward crop by allowing contain */
    object-fit: {{ section.settings.bg_fit_desktop }};
    object-position: {{ section.settings.bg_position_desktop }};
  }

  #FooterCustom-{{ section.id }} .footer-custom__inner {
    position: relative;
    z-index: 1;
    height: 100%;
  }

  /* Row 1 layout */
  #FooterCustom-{{ section.id }} .footer-custom__top {
    display: grid;
    gap: 3rem;
    grid-template-columns: repeat(3, 1fr);
  }

  #FooterCustom-{{ section.id }} .footer-custom__right {
    display: flex;
    justify-content: space-between;
    gap: 32px;
  }

  @media (min-width: 750px) {
    #FooterCustom-{{ section.id }} .footer-custom__right {
      grid-column-start: 3;
    }
  }

  #FooterCustom-{{ section.id }} .footer-custom__menu-col {
    flex: 1 1 160px;
    min-width: 160px;
  }

  #FooterCustom-{{ section.id }} .footer-custom__heading {
    margin: 0 0 12px 0;
  }

  /* Intro copy above form/embed */
  #FooterCustom-{{ section.id }} .footer-custom__intro {
    margin-bottom: 16px;
  }
  #FooterCustom-{{ section.id }} .footer-custom__intro h3 {
    margin: 0 0 8px 0;
  }
  #FooterCustom-{{ section.id }} .footer-custom__intro .rte {
    margin: 0;
  }

  /* Socials under newsletter/embed */
  #FooterCustom-{{ section.id }} .footer-custom__socials {
    margin-top: 16px;
  }

  /* Menus: remove markers */
  #FooterCustom-{{ section.id }} .footer-custom__menu {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #FooterCustom-{{ section.id }} .footer-custom__menu li::marker {
    content: none;
  }

  /* Desktop hover underline (Broadcast-like) */
  @media (hover: hover) and (min-width: 750px) {
    #FooterCustom-{{ section.id }} .footer-custom__link .navtext {
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 0.2em;
      text-decoration-color: transparent;
      transition: text-decoration-color 180ms ease;
    }
    #FooterCustom-{{ section.id }} .footer-custom__link:hover .navtext {
      text-decoration-color: currentColor;
    }
  }

  /* Accordion styles (mobile) */
  #FooterCustom-{{ section.id }} .footer-custom__accordion {
    border: 0;
  }

  #FooterCustom-{{ section.id }} .footer-custom__accordion__summary {
    list-style: none;
    cursor: pointer;
    padding: 10px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  #FooterCustom-{{ section.id }} .footer-custom__accordion__summary::-webkit-details-marker {
    display: none;
  }

  #FooterCustom-{{ section.id }} .footer-custom__accordion__summary::after {
    display: inline-block;
    margin-left: 12px;
    line-height: 1;
  }

  /* Accordion icon (Broadcast-style arrow) */
#FooterCustom-{{ section.id }} .footer-custom__accordion__icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-left: 12px;
  transition: transform 220ms ease;
}

#FooterCustom-{{ section.id }} details[open] .footer-custom__accordion__icon {
  transform: rotate(180deg);
}

/* Match Broadcast sizing */
#FooterCustom-{{ section.id }} .footer-custom__accordion__icon svg {
  width: 18px;
  height: 18px;
}

 

  #FooterCustom-{{ section.id }} .footer-custom__accordion__content {
    padding: 6px 0 0 0;
  }

  /* Row 2 logo inside container (respects margins) */
  #FooterCustom-{{ section.id }} .footer-custom__logo-full {
    margin-top: 5rem;
  }
  #FooterCustom-{{ section.id }} .footer-custom__logo-full img {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Full-width border-top above credits row */
  #FooterCustom-{{ section.id }} .footer-custom__divider {
    width: 100vw;
    position: relative;
    left: 50%;
    transform: translateX(-50%);
    border-top: 1px solid currentColor;
    opacity: 1;
    margin-top: 24px;
  }


  #FooterCustom-{{ section.id }} .footer-custom__bottom-inner {
    display: flex;
    justify-content: space-between;
    gap: 16px;
    flex-wrap: wrap;
    align-items: center;
  }

  /* Klaviyo embed should not overflow */
  #FooterCustom-{{ section.id }} .footer-custom__embed,
  #FooterCustom-{{ section.id }} .footer-custom__embed * {
    max-width: 100%;
  }

  /* Show desktop menu layout, hide accordion */
  @media (min-width: 750px) {
    #FooterCustom-{{ section.id }} .footer-custom__accordion {
      display: none;
    }
    #FooterCustom-{{ section.id }} .footer-custom__menu-desktop {
      display: block;
    }
  }

  /* Mobile: show accordions, hide desktop menu layout */
  @media (max-width: 749px) {
    #FooterCustom-{{ section.id }} {
      min-height: {{ footer_vh_mobile }}vh;
    }

    #FooterCustom-{{ section.id }} .footer-custom__bg {
      height: {{ bg_height_mobile }}px;
    }

    /* Mobile should be cover (so it isn't too small) */
    #FooterCustom-{{ section.id }} .footer-custom__bg img {
      object-fit: cover;
      object-position: bottom center;
    }

    #FooterCustom-{{ section.id }} .footer-custom__top {
      grid-template-columns: 1fr !important;
      gap: 24px;
    }

    #FooterCustom-{{ section.id }} .footer-custom__right {
      display: block;
      gap: 0;
    }

    #FooterCustom-{{ section.id }} .footer-custom__menu-desktop {
      display: none;
    }

    #FooterCustom-{{ section.id }} .footer-custom__accordion {
      display: block;
    }
  }
{%- endstyle -%}

<footer
  id="FooterCustom-{{ section.id }}"
  class="footer-custom color-{{ section.settings.color_scheme }}"
  role="contentinfo"
>
  {%- if bg_image != blank -%}
    <div class="footer-custom__bg" aria-hidden="true">
      <img
        src="{{ bg_image | image_url: width: 2400 }}"
        srcset="
          {{ bg_image | image_url: width: 750 }} 750w,
          {{ bg_image | image_url: width: 1100 }} 1100w,
          {{ bg_image | image_url: width: 1600 }} 1600w,
          {{ bg_image | image_url: width: 2400 }} 2400w
        "
        sizes="100vw"
        alt=""
        loading="lazy"
      >
    </div>
  {%- endif -%}

  <div class="footer-custom__inner section-padding">
    <div class="container">
      <!-- ROW 1 -->
      <div class="footer-custom__top">
        <div class="footer-custom__left">
          {%- if intro_heading != blank or intro_body != blank -%}
            <div class="footer-custom__intro">
              {%- if intro_heading != blank -%}
                <h3 class="footer-custom__heading">{{ intro_heading | escape }}</h3>
              {%- endif -%}
              {%- if intro_body != blank -%}
                <div class="rte">{{ intro_body }}</div>
              {%- endif -%}
            </div>
          {%- endif -%}

          {%- if klaviyo_embed != blank -%}
            <div class="footer-custom__embed">
              {{ klaviyo_embed }}
            </div>
          {%- else -%}
            {%- if newsletter_block != blank -%}
              {%- render 'newsletter-form', block: newsletter_block, show_discount_message: false, success_text: '', small_newsletter: false -%}
            {%- else -%}
              <p>{{ 'general.newsletter_form.newsletter_email' | t }}</p>
            {%- endif -%}
          {%- endif -%}

          <div class="footer-custom__socials">
            {%- render 'social-icons' -%}
          </div>
        </div>

        <div class="footer-custom__right">
          <!-- MENU 1 -->
          <div class="footer-custom__menu-col">
            {%- if menu_1 != blank and linklists[menu_1].links.size > 0 -%}
              <details class="footer-custom__accordion">
                <summary class="footer-custom__accordion__summary">
                    <span class="footer-custom__heading">{{ menu_1_title | escape }}</span>

                    <span class="footer-custom__accordion__icon" aria-hidden="true">
                      <svg aria-hidden="true" focusable="false" role="presentation"
                        class="icon icon-nav-arrow-down"
                        viewBox="0 0 24 24">
                        <path d="m6 9 6 6 6-6"
                          stroke="currentColor"
                          stroke-linecap="round"
                          stroke-linejoin="round"></path>
                      </svg>
                    </span>
                  </summary>
                <div class="footer-custom__accordion__content">
                  <ul class="footer-custom__menu list-unstyled">
                    {%- for link in linklists[menu_1].links -%}
                      <li>
                        <a class="footer-custom__link navlink" href="{{ link.url }}">
                          <span class="navtext">{{ link.title }}</span>
                        </a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </div>
              </details>

              <div class="footer-custom__menu-desktop">
                {%- if menu_1_title != blank -%}
                  <h3 class="footer-custom__heading">{{ menu_1_title | escape }}</h3>
                {%- endif -%}
                <ul class="footer-custom__menu list-unstyled">
                  {%- for link in linklists[menu_1].links -%}
                    <li>
                      <a class="footer-custom__link navlink" href="{{ link.url }}">
                        <span class="navtext">{{ link.title }}</span>
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            {%- endif -%}
          </div>

          <!-- MENU 2 -->
          <div class="footer-custom__menu-col">
            {%- if menu_2 != blank and linklists[menu_2].links.size > 0 -%}
              <details class="footer-custom__accordion">
                <summary class="footer-custom__accordion__summary">
                  <span class="footer-custom__heading">{{ menu_1_title | escape }}</span>

                  <span class="footer-custom__accordion__icon" aria-hidden="true">
                    <svg aria-hidden="true" focusable="false" role="presentation"
                      class="icon icon-nav-arrow-down"
                      viewBox="0 0 24 24">
                      <path d="m6 9 6 6 6-6"
                        stroke="currentColor"
                        stroke-linecap="round"
                        stroke-linejoin="round"></path>
                    </svg>
                  </span>
                </summary>
                <div class="footer-custom__accordion__content">
                  <ul class="footer-custom__menu list-unstyled">
                    {%- for link in linklists[menu_2].links -%}
                      <li>
                        <a class="footer-custom__link navlink" href="{{ link.url }}">
                          <span class="navtext">{{ link.title }}</span>
                        </a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </div>
              </details>

              <div class="footer-custom__menu-desktop">
                {%- if menu_2_title != blank -%}
                  <h3 class="footer-custom__heading">{{ menu_2_title | escape }}</h3>
                {%- endif -%}
                <ul class="footer-custom__menu list-unstyled">
                  {%- for link in linklists[menu_2].links -%}
                    <li>
                      <a class="footer-custom__link navlink" href="{{ link.url }}">
                        <span class="navtext">{{ link.title }}</span>
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              </div>
            {%- endif -%}
          </div>
        </div>
      </div>

      <!-- ROW 2 -->
      {%- if logo_full != blank -%}
        <div class="footer-custom__logo-full">
          <img
            src="{{ logo_full | image_url: width: 2400 }}"
            srcset="
              {{ logo_full | image_url: width: 750 }} 750w,
              {{ logo_full | image_url: width: 1100 }} 1100w,
              {{ logo_full | image_url: width: 1600 }} 1600w,
              {{ logo_full | image_url: width: 2400 }} 2400w
            "
            sizes="100vw"
            alt="{{ logo_full.alt | default: shop.name | strip_html | escape }}"
            loading="lazy"
          >
        </div>
      {%- endif -%}
    </div><!-- /.container -->

    <!-- Full-width divider -->
    <div class="footer-custom__divider" aria-hidden="true"></div>

    <!-- ROW 3 (full width divider, but text aligned) -->
    <div class="footer-custom__bottom">
      <div class="container">
        <div class="footer-custom__bottom-inner">
          <div class="footer-custom__copyright">
            Copyright &copy; {{ shop.name }} {{ 'now' | date: '%Y' }}
          </div>

          <div class="footer-custom__credits">
            {%- if credits_url != blank -%}
              <a class="navlink" href="{{ credits_url }}">
                <span class="navtext">{{ credits_label | default: 'Credits' | escape }}</span>
              </a>
            {%- else -%}
              <span class="navtext">{{ credits_label | default: 'Credits' | escape }}</span>
            {%- endif -%}
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

{% schema %}
{
  "name": "Custom footer",
  "tag": "section",
  "class": "custom-footer",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme_1"
    },
    {
      "type": "header",
      "content": "Footer height"
    },
    {
      "type": "range",
      "id": "footer_vh_desktop",
      "label": "Minimum height (desktop)",
      "min": 20,
      "max": 120,
      "step": 5,
      "unit": "vh",
      "default": 60
    },
    {
      "type": "range",
      "id": "footer_vh_mobile",
      "label": "Minimum height (mobile)",
      "min": 20,
      "max": 140,
      "step": 5,
      "unit": "vh",
      "default": 70
    },
    {
      "type": "header",
      "content": "Background image"
    },
    {
      "type": "image_picker",
      "id": "bg_image",
      "label": "Background image",
      "info": "Pinned to the bottom, full width."
    },
    {
      "type": "select",
      "id": "bg_fit_desktop",
      "label": "Background fit (desktop)",
      "default": "contain",
      "options": [
        { "value": "contain", "label": "Contain (no crop)" },
        { "value": "cover", "label": "Cover (crop)" }
      ]
    },
    {
      "type": "select",
      "id": "bg_position_desktop",
      "label": "Background position (desktop)",
      "default": "bottom center",
      "options": [
        { "value": "top center", "label": "Top" },
        { "value": "center center", "label": "Center" },
        { "value": "bottom center", "label": "Bottom" }
      ]
    },
    {
      "type": "range",
      "id": "bg_height_desktop",
      "label": "Background height (desktop)",
      "min": 100,
      "max": 800,
      "step": 20,
      "unit": "px",
      "default": 320
    },
    {
      "type": "range",
      "id": "bg_height_mobile",
      "label": "Background height (mobile)",
      "min": 100,
      "max": 700,
      "step": 20,
      "unit": "px",
      "default": 260
    },
    {
      "type": "header",
      "content": "Left column intro"
    },
    {
      "type": "text",
      "id": "intro_heading",
      "label": "Heading",
      "default": "Stay in the loop"
    },
    {
      "type": "richtext",
      "id": "intro_body",
      "label": "Body copy",
      "default": "<p>Subscribe for updates, product drops, and more.</p>"
    },
    {
      "type": "header",
      "content": "Top row"
    },
    {
      "type": "liquid",
      "id": "klaviyo_embed",
      "label": "Klaviyo embed (optional)",
      "info": "If filled, this will replace the newsletter form."
    },
    {
      "type": "text",
      "id": "menu_1_title",
      "label": "Menu column 1 heading",
      "default": "Explore"
    },
    {
      "type": "link_list",
      "id": "menu_1",
      "label": "Menu column 1"
    },
    {
      "type": "text",
      "id": "menu_2_title",
      "label": "Menu column 2 heading",
      "default": "Support"
    },
    {
      "type": "link_list",
      "id": "menu_2",
      "label": "Menu column 2"
    },
    {
      "type": "header",
      "content": "Full-width logo"
    },
    {
      "type": "image_picker",
      "id": "logo_full",
      "label": "Logo image (inside site margins)",
      "info": "Displayed at 100% width of the content container."
    },
    {
      "type": "header",
      "content": "Bottom row"
    },
    {
      "type": "text",
      "id": "credits_label",
      "label": "Credits label",
      "default": "Credits"
    },
    {
      "type": "url",
      "id": "credits_url",
      "label": "Credits link"
    }
  ],
  "blocks": [
    {
      "type": "newsletter",
      "name": "Newsletter",
      "limit": 1,
      "settings": [
        {
          "type": "checkbox",
          "id": "show_name",
          "label": "Show name field",
          "default": false
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Subscribe"
        },
        {
          "type": "select",
          "id": "button_type",
          "label": "Button color",
          "default": "btn--primary",
          "options": [
            { "value": "btn--primary", "label": "Primary" },
            { "value": "btn--secondary", "label": "Secondary" },
            { "value": "btn--black", "label": "Black" },
            { "value": "btn--white", "label": "White" }
          ]
        },
        {
          "type": "select",
          "id": "button_size",
          "label": "Button size",
          "default": "btn--small",
          "options": [
            { "value": "btn--small", "label": "Small" },
            { "value": "btn--medium", "label": "Medium" },
            { "value": "btn--large", "label": "Large" }
          ]
        },
        {
          "type": "select",
          "id": "button_style",
          "label": "Button style",
          "default": "btn--solid",
          "options": [
            { "value": "btn--solid", "label": "Solid" },
            { "value": "btn--outline", "label": "Outline" },
            { "value": "btn--text", "label": "Text" }
          ]
        },
        {
          "type": "checkbox",
          "id": "show_arrow",
          "label": "Show arrow",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "terms",
          "label": "Show spam disclaimer",
          "default": false
        },
        {
          "type": "color",
          "id": "color",
          "label": "Override text color (optional)",
          "alpha": true
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom footer",
      "blocks": [
        { "type": "newsletter" }
      ]
    }
  ]
}
{% endschema %}
